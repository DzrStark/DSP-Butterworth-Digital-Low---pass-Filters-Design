# 巴特沃斯数字低通滤波器


[TOC]

## 一、低通滤波器参数

- 通带频率fp：4kHz
- 阻带频率fs：20kHz
- 通带最大衰减Ap：0.5dB
- 阻带最大衰减As：45dB
- 采样频率Fs：80kHz
- 滤波器类型：巴特沃斯低通滤波器

##   二、题目要求

> 在满足上述指标要求的情况下，分别设计如下滤波器：
>
> （1）利用matlab函数直接设计数字滤波器；
>
> （2）利用matlab函数先设计模拟滤波器，后用脉冲响应不变法转为数字滤波器
>
> （3）利用matlab函数先设计模拟滤波器，后用双线性变换法转为数字滤波器
>
> （4）比较1、2、3的区别，观测频谱混叠与非线性失真。

​	为了下文叙述的合理与连贯，我将会先设计符合参数的**模拟巴特沃斯低通滤波器**并给出其相频特性。之后再按1、2、3的顺序来完成任务。

## 三、设计模拟低通滤波器

### 3.1 弧度频率与归一化频率

1. **弧度频率 ：**

- 计算公式是$$ W=2  π  f$$，这是基于角频率的计算方式。在这种情况下，$Wp$和$Ws$ 是模拟滤波器的实际频率，单位是弧度每秒（rad/s）。

2. **归一化频率：**

- 归一化频率是相对于采样频率的一种表示方法。在数字信号处理中，归一化频率是通过将频率除以 Nyquist 频率（采样频率的一半$\frac{F_{S}}{2}$）来得到的。归一化频率的范围是$[0, 1]$。
- 如果你是设计数字滤波器，通常会使用归一化频率。在这种情况下，$Wp$ 和 $Ws$ 就会被归一化处理，即通过 $Wp = fp / (Fs / 2)$ 和 $Ws = fs / (Fs / 2)$。

3. **总结：**

- 在**模拟滤波器**设计中，我们通常使用**弧度频率**。
- 在**数字滤波器**设计中，我们通常使用**归一化频率**。

4. **在模拟滤波器中的使用：**

​	由于此处设计的是模拟滤波器，所以我们使用弧度频率。可以得到：
$$
 W_{p}=2\pi f_{p}
$$

$$
 W_{s}=2\pi f_{s}
$$

### 3.2 调用buttord和butter设计模拟低通滤波器

```matlab
% 计算模拟滤波器的阶数和截止频率
[N, Wc] = buttord(Wp, Ws, Ap, As, 's'); 

% 使用 butter 设计模拟低通滤波器
[b, a] = butter(N, Wc, 's');
```

计算结果如下：

![image-20241213140006558](C:\Users\DcStark\AppData\Roaming\Typora\typora-user-images\image-20241213140006558.png)

将b和a代入下式写出系统函数：
$$
H_{analog}(s)=\frac{B}{s^{4}+A(2)s^{3}+A(3)s^{2}+A(4)s+A(5)}
$$
对应的幅频曲线如下：

![image-20241213141004628](C:\Users\DcStark\AppData\Roaming\Typora\typora-user-images\image-20241213141004628.png)

### 3.3 理论分析

（1）确定阶数N
$$
k_{sp}=\sqrt{\frac{10^{0.1As}-1}{10^{0.1Ap}-1}}
$$

$$
\lambda_{sp}=\frac{2\pi f_{s}}{2pi f_{p}}
$$

$$
N=\frac{lg k_{sp}}{lg\lambda_{sp}}
$$

​	   我们这里利用**Mathematica**计算可以得到N=4，源码如下：

![image-20241213154109381](C:\Users\DcStark\AppData\Roaming\Typora\typora-user-images\image-20241213154109381.png)

（2）根据阶数N查表可得$G_{a}(p)$
$$
G_{a}(p)=\frac{1}{(p^2+0.7654p+1)(p^2+1.8478p+1)}
$$
  (3)   将$G_{a}(p)$去归一化

求得$w_{c}$：
$$
w_{c}=2\pi f_{p}(10^{0.1\alpha_{p}}-1)^{-\frac{1}{2N}}
$$
将$p=s/w_{c}$代入$G_{a}(p)$中，得到：
$$
H_{s}(s)=\frac{w^5_{c}}{s^{4}+b_{3}w^1_{c}s^{3}+b_{2}w^2_{c}s^{2}+b_{1}w^3_{c}s+b_{0}w^4_{c}}
$$
**与上文Matlab计算结果形式相同。**

## 四、利用matlab函数直接设计数字滤波器

### 4.1 归一化频率

由于此处是数字滤波器，所以使用归一化频率：

```matlab
Wp = fp / (Fs / 2);  % 通带归一化频率
Ws = fs / (Fs / 2);  % 阻带归一化频率
```

### 4.2 调用buttord和butter直接设计低通滤波器

```matlab
% 使用 buttord 计算最小阶数和截止频率
[n, Wn] = buttord(Wp, Ws, Ap, As);

% 使用 butter 设计巴特沃斯滤波器
[b, a] = butter(n, Wn);
```

计算结果如下：

![image-20241213151107548](C:\Users\DcStark\AppData\Roaming\Typora\typora-user-images\image-20241213151107548.png)
$$
H(z)=\frac{B(z)}{A(z)}=\frac{B(1)+B(2)z^{-1}+B(3)z^{-2}+B(4)z^{-3}+B(5)z^{-4}}{A(1)+A(2)z^{-1}+A(3)z^{-2}+A(4)z^{-3}+A(5)z^{-4}}
$$
对应的幅频曲线如下：

![image-20241215234917700](C:\Users\DcStark\AppData\Roaming\Typora\typora-user-images\image-20241215234917700.png)

**由于采样频率是80kHz，所以图上0.5的位置对应20kHz，可以看到此时的阻带最小衰减为-45dB，符合题目要求。**

### 4.3 相位跳变问题

需要注意的是，直接分析相频曲线会由于**相位跳变**的问题。在信号处理中，相位通常限定在 −π 到 π 的范围内，这叫做相位的“**折叠**”。如果滤波器的相位响应或信号的相位随频率变化较快，会出现突然的跳变。例如，相位从 π 跳到 −π 或从−π 跳到 π。这并不反映真实的相位特性，而是由于周期性的限制引入了“断裂”。生成不平滑的相位曲线：

![image-20241215233733416](C:\Users\DcStark\AppData\Roaming\Typora\typora-user-images\image-20241215233733416.png)

`unwrap` 通过以下操作解决相位跳变的问题：

1. **检测相邻点之间的相位差**：计算每个相邻点的相位增量。

2. 修正过大的相位跳变

   如果相邻点的相位增量超过某个阈值（通常是π），则将其调整到连续范围内。

   - 如果相位增量大于π，则减去2π。
   - 如果相位增量小于 −π，则加上2π。

![image-20241213152328253](C:\Users\DcStark\AppData\Roaming\Typora\typora-user-images\image-20241213152328253.png)

​	**为了便于观察，后文将保持未使用unwrap函数的状态。**

## 五、利用matlab函数先设计模拟滤波器，后用脉冲响应不变法转为数字滤波器

### 5.1 归一化频率

由于此处设计的是模拟滤波器，所以我们使用弧度频率。可以得到：
$$
 W_{p}=2\pi f_{p}
$$

$$
 W_{s}=2\pi f_{s}
$$

```matlab
Wp = 2*pi*fp; % 通带频率转换为弧度频率
Ws = 2*pi*fs; % 阻带频率转换为弧度频率
```

### 5.2  调用buttord和butter设计模拟低通滤波器

```matlab
% 计算模拟滤波器的阶数和截止频率
[N, Wc] = buttord(Wp, Ws, Ap, As, 's'); 

% 使用 butter 设计模拟低通滤波器
[b, a] = butter(N, Wc, 's');
```

计算结果如下：

![image-20241213152936698](C:\Users\DcStark\AppData\Roaming\Typora\typora-user-images\image-20241213152936698.png)

将b和a代入下式写出系统函数：
$$
H_{analog}(s)=\frac{B}{s^{4}+A(2)s^{3}+A(3)s^{2}+A(4)s+A(5)}
$$
这里可以看到和我们上文3.2的计算结果是完全相同的。



### 5.3 调用impinvar函数设计数字低通滤波器

```matlab
%使用脉冲响应不变法将模拟滤波器转换为数字滤波器
[bz, az] = impinvar(b, a, Fs);  % 通过脉冲响应不变法进行数字化转换
```

计算结果如下：

![image-20241213153639972](C:\Users\DcStark\AppData\Roaming\Typora\typora-user-images\image-20241213153639972.png)

由bz和az写出数字滤波器系统函数：
$$
H(z)=\frac{B(z)}{A(z)}=\frac{B(1)+B(2)z^{-1}+B(3)z^{-2}+B(4)z^{-3}+B(5)z^{-4}}{A(1)+A(2)z^{-1}+A(3)z^{-2}+A(4)z^{-3}+A(5)z^{-4}}
$$
画出对应的幅频与相频特性曲线：

![image-20241215233842704](C:\Users\DcStark\AppData\Roaming\Typora\typora-user-images\image-20241215233842704.png)

### 5.4 频谱混叠现象

**频谱混叠的实质**

- 如果模拟滤波器的频率响应Ha(jΩ) 的频谱分量超出奈奎斯特频率（π/T），这些高频分量会被混叠到数字滤波器的工作频带[0,π/T]内，导致失真。
- 这种混叠无法通过数字滤波器的设计消除，因为采样本身已丢失高频信息。

![image-20241215234138048](C:\Users\DcStark\AppData\Roaming\Typora\typora-user-images\image-20241215234138048.png)

由图可见，频率响应不变法设计的数字滤波器频率响应特性基本模拟了模拟滤波器的频率响应形状，但存在频谱混叠失真。模拟滤波器的损耗函数在**f=Fs/2**点的衰减为-69.0483dB,而数字滤波器的损耗函数在$ \pi $点的衰减为-63.4986dB,这就是**频谱失真**引起的**-5.5497dB的衰减误差**。从这个**40kHz频率（$\pi$处）**来看，脉冲响应不变法受到**频谱混叠**的影响，整体其实是存在一个**“抬升”**的情况。

## 六、利用matlab函数先设计模拟滤波器，后用双线性变换法转为数字滤波器

### 6.1 归一化频率

由于此处设计的是模拟滤波器，所以我们使用弧度频率。可以得到：
$$
 W_{p}=2\pi f_{p}
$$

$$
 W_{s}=2\pi f_{s}
$$

```matlab
Wp = 2*pi*fp; % 通带频率转换为弧度频率
Ws = 2*pi*fs; % 阻带频率转换为弧度频率
```

### 5.2  调用buttord和butter设计模拟低通6

```matlab
% 计算模拟滤波器的阶数和截止频率
[N, Wc] = buttord(Wp, Ws, Ap, As, 's'); 

% 使用 butter 设计模拟低通滤波器
[b, a] = butter(N, Wc, 's');
```

计算结果如下：

![image-20241213152936698](C:\Users\DcStark\AppData\Roaming\Typora\typora-user-images\image-20241213152936698.png)

将b和a代入下式写出系统函数：
$$
H_{analog}(s)=\frac{B}{s^{4}+A(2)s^{3}+A(3)s^{2}+A(4)s+A(5)}
$$
这里可以看到和我们上文3.2的计算结果是完全相同的。

### 6.3 调用bilinear函数设计数字低通滤波器

```matlab
% 使用双线性变换法将模拟滤波器转换为数字滤波器
[bz, az] = bilinear(b, a, Fs);  % 通过双线性变换法进行数字化转换
```

计算结果如下：

![image-20241213155059908](C:\Users\DcStark\AppData\Roaming\Typora\typora-user-images\image-20241213155059908.png)

由bz和az写出数字滤波器系统函数：
$$
H(z)=\frac{B(z)}{A(z)}=\frac{B(1)+B(2)z^{-1}+B(3)z^{-2}+B(4)z^{-3}+B(5)z^{-4}}{A(1)+A(2)z^{-1}+A(3)z^{-2}+A(4)z^{-3}+A(5)z^{-4}}
$$
画出对应的幅频与相频特性曲线：

![image-20241213155129646](C:\Users\DcStark\AppData\Roaming\Typora\typora-user-images\image-20241213155129646.png)

### 6.4非线性失真现象

双线性变换法实现了非线性压缩，这种非线性压缩会导致如下影响：

1. **频率失真**

- 结果是，高频特性（如滤波器的截止频率、带宽等）在数字滤波器中与原模拟滤波器不同。

2. **滤波器特性改变**

- 模拟滤波器设计的幅频和相频特性在数字域中会发生偏离。

![image-20241215234713450](C:\Users\DcStark\AppData\Roaming\Typora\typora-user-images\image-20241215234713450.png)

从图中可以看出，双线性变换法设计的数字滤波器并不存在频谱混叠，但存在**频率非线性失真**，所有数字滤波器与模拟滤波器频率特性曲线差别较大，而且，**频率越高，频率非线性失真越严重**。**幅频特性曲线**已经有了较明显的**偏离**，也就是**非线性失真**。

## 七、实验心得

本次实验让我深刻掌握了关于两种滤波器设计方法的差异。

报告中使用了Latex和Mathematica辅助完成，全部代码均为手敲，让我加深了我的写作能力！

也让我明白通信应该在实践中学习！